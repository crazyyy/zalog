/* v.1.0.1 build 2 */
!function(t,e,o){function i(t){this.opts={session_timeout:1800},this.opts.urls={regionList:"http://gl.leadmail.ru/api/landings/regions",additionalCode:"http://gl.leadmail.ru/api/landings/stat/additional-code",hit:"http://gl.leadmail.ru/api/landings/stat/hit",target:"http://gl.leadmail.ru/api/landings/stat/target",createLead:"http://gl.leadmail.ru/api/lead/create"},o.extend(this.opts,t)}function n(t){var o=e.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return o?decodeURIComponent(o[1]):void 0}i.prototype.getRegions=function(){return o.get(this.urls.regionList,"json")},i.prototype.getRegionOptions=function(){return this.getRegions().pipe(function(t){for(var e="",o=0;o<t.length;++o)e+='<option value="'+t[o].id+'">'+t[o].title+"</option>";return e})},i.prototype.additionalCode=function(t,e){return t=t||getParameterByName("lead"),e=e||getParameterByName("hash"),o.get(this.opts.urls.additionalCode,{lead_id:t,prefix:e})},i.prototype.hit=function(i){var r=this.opts.urls.hit;i=i||t.getPrefix&&t.getPrefix()||"";var a=n("visit"+i);if(!a){var s=new Date((new Date).getTime()+1e3*this.opts.session_timeout),u="visit"+i+"=true;path=/;expires="+s.toUTCString()+";max-age="+this.opts.session_timeout+";";e.cookie=u,r+="?visit=true"}return o.post(r,{prefix:i})},i.prototype.target=function(e){return o.post(this.opts.urls.target,{prefix:e||t.getPrefix()})},i.prototype.googleEvent=function(e){var o=jQuery.Deferred();return void 0!==t.ga?t.ga("send","event","lead",e,{hitCallback:function(){o.resolve({status:!0,type:e})}}):o.resolve({status:!1,type:e}),o.promise()},i.prototype.init=function(){e.cookie="search_query="+t.location.search},i.prototype.createLead=function(t){var e=this,i=new o.Deferred;return e.googleEvent("core_sent").then(function(){o.post(e.opts.urls.createLead,t).done(function(t){"success"===t.status?e.googleEvent("core_created").then(function(){e.target().always(function(){i.resolve(t)})}):e.googleEvent("core_error").then(function(){i.reject(t)})}).fail(function(t){e.googleEvent("core_fatal_error").then(function(){i.reject(t)})})}),i},t.glcore=new i,o(function(){glcore.init(),setTimeout(function(){glcore.hit()},1e3)})}(window,document,jQuery);